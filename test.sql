-- test

SELECT * FROM patients;

SELECT pgp_key_id(dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBF56bLUBCADNoxSLBT/ou9RMtlNcXbJVgmjvclDVf8NG8Suew/XZI2Bs5PjO
d7aR/kvk/DkBRD96/Q6yW0vt9OYf32tQOZUgylOqnpBC1o0TmWPYTFcb50KJNDwa
D85d70PG9EHvIAsGpAKDWlZhGiQd01+TU2tb2OJBFxf78w2tK8G47O4IqRGHMkhL
iJGxoCapaVFQyuT6RR+/iDOmZ0K7rsFNgVm4q/iFSrQIsXzKkph0oXD++CgCYjwK
eg4YScVcIT07OLwI+jksOADBp2J0rsJ9We7EFcWMFoHFZnaEV+K5EnfzCWPGFuR1
KmvAcDycoopM5f9ygeHa7+bHHvhcXcKJ24qvABEBAAG0KkthbWlsIFN1Y2hhbmVr
IDxrYW1pbHN1Y2hhbmVrOTVAZ21haWwuY29tPokBVAQTAQgAPhYhBJ/cTkD3Sw6J
3O+1ONZ6nKHmVU8LBQJeemy1AhsDBQkDwmcABQsJCAcCBhUKCQgLAgQWAgMBAh4B
AheAAAoJENZ6nKHmVU8LGQoIAMlHJr/12GWHFfS0/loUXLUIUMOwF6H0kSGmhPZV
SjDWer2Y+g4C6pqKB1M6X1FsQt8m/JBX+cBWbYuPDJIgPb3UiS8Fk5uASLxMeI7a
/EPyW/SpgPlPVrjaTedGqbkJpIZSzn79vwGBYBqqdsN2qD07ZOq3hFqJMXEPtXp8
Fm4VnsnMkHYt/6jlih2DVM8L+Em+C0a0VyhcCsP7qbyi6yL5WCX7wn+LHIq7HVw/
vITHLxh4ll2WgSeOqWtFXFKZkl7yxjRjDKcJG38jUGSl9/zsq/9xzYTF4QMJX4lR
7y513Wsox5Qp5lIrtX4A+lb0u5wr9+NWmduhn3tfVSvoUPO5AQ0EXnpstQEIAMH3
u9JaO7LlvZlxPlyrBKtdlQE0TBZ755f1YWdtHUHlj9FS0kD2g7IxKHXjWD+gG5Qb
Adm9PWS/kXt+l/yvapMF/6Whe7j/qG55Pav+S1YE4A73PorH6L0kD/WcHKPS7yxw
ZUW6iadwkahqLePYEq2eKLkdYhwWmDx4fluHtGW0yfiTAzEOWMJkI8UH16kECzmy
ae/YrPumylxXQXdWwa+YSCgqZP8nJ/DXTtTXTHEww4KvkcpZNY8w5ly7ocRmx5vQ
sdWX7zFZHvQjc7BvkDLs314ld8ccb6rd3amhS+nhfQH91A5IAuWmrYGuQHoueWuW
TSY7RsvbhbcADCvYlwUAEQEAAYkBPAQYAQgAJhYhBJ/cTkD3Sw6J3O+1ONZ6nKHm
VU8LBQJeemy1AhsMBQkDwmcAAAoJENZ6nKHmVU8LA1QH/2Xf7iyxkR6SAduREMre
xbe17CdbAFrbJMHxQA9XEejf2mtUV+qAVBRGneIKL+oAkbnyUqJvB2KoKvD+jcfP
AYWcMd9mMeAwxbqVGz3dFCTb2aEbeV2tJTgTzg2G+Nd4rPks2pbcZgUJuA9O01Ac
MkXspCO3+QmwmfEdzY4wX5AmCq6fg1U4TkQiKWVl+zDr8EXYAGPKp0cV/AetJU/o
E040Rr3UOrRDye/61OVKwBqpu83bzr4US6xngM1cRTdL6oTLJCzudnITFZuHyFGU
VTTpLsn/YVwKWVjNFpG3XXmM/QrFTYsk/f4/C60dW6eimjNTyjsY1iwlCCAwXvMH
GzM=
=pLjO
-----END PGP PUBLIC KEY BLOCK-----
'));

SELECT patient_id, 
pgp_key_id(first_name) AS first_name, 
pgp_key_id(last_name) AS last_name
FROM patients;

SELECT patient_id, 
pgp_pub_decrypt(first_name, keys.privkey, 'password') AS first_name,
pgp_pub_decrypt(last_name, keys.privkey, 'password') AS last_name,
pgp_pub_decrypt(pesel, keys.privkey, 'password') AS pesel
FROM patients 
    CROSS JOIN
    (SELECT dearmor('-----BEGIN PGP PRIVATE KEY BLOCK-----

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
8wcbMw==
=79lD
-----END PGP PRIVATE KEY BLOCK-----
') As privkey) As keys;
